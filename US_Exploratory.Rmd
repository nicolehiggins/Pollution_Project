---
title: "US_Exploratory"
author: "Nicole and Caedmon"
output: html_document
---

```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = TRUE)
```

```{r, eval=FALSE}
library(tidyverse)
library(lubridate)     
library(ggthemes)      
library(readr)
library(geofacet)     
library(maps)          # for map data
library(ggmap)         # for mapping points on maps
library(gplots)        # for col2hex() function
library(RColorBrewer)  # for color palettes
library(sf)            # for working with spatial data
library(leaflet)       # for highly customizable
library(gganimate)
library(googlesheets4)
library(gt)
library(plotly)
theme_set(theme_minimal())
```

```{r}
pol_1980 <- read_csv("pol_1980.csv")
pol_2000 <- read_csv("pol_2000.csv")
pol_2015 <- read_csv("pol_2015.csv")
pol_2020 <- read_csv("pol_2020.csv")
```

```{r}
pol_1980 %>%
  arrange(desc(AQI)) %>%
  head(AQI, n = 10) %>%
  subset(select = c(`State Name`, `County Name`, AQI)) %>%
  gt(rowname_col = "County Name") %>%
  tab_stubhead("County") %>%
  tab_header(title = md("**Highest AQI Counties 1980**"))
```

```{r}
pol_1980 %>%
  arrange(desc(AQI)) %>%
  head(AQI, n = 10) %>%
  subset(select = c(`State Name`, `County Name`, AQI)) %>%
  mutate(year = "1980") -> hi_AQI_1980
pol_2000 %>%
  arrange(desc(AQI)) %>%
  head(AQI, n = 10) %>%
  subset(select = c(`State Name`, `County Name`, AQI)) %>%
  mutate(year = "2000") -> hi_AQI_2000
pol_2015 %>%
  arrange(desc(AQI)) %>%
  head(AQI, n = 10) %>%
  subset(select = c(`State Name`, `County Name`, AQI)) %>%
  mutate(year = "2015") -> hi_AQI_2015
pol_2020 %>%
  arrange(desc(AQI)) %>%
  head(AQI, n = 10) %>%
  subset(select = c(`State Name`, `County Name`, AQI)) %>%
  mutate(year = "2020") -> hi_AQI_2020

hi_AQI_1980 %>%
  full_join(hi_AQI_2000,
            by = c("State Name", "County Name", "AQI", "year")) %>%
  full_join(hi_AQI_2015,
            by = c("State Name", "County Name", "AQI", "year")) %>%
  full_join(hi_AQI_2020,
            by = c("State Name", "County Name", "AQI", "year")) -> all_hi_AQI
```

```{r}
all_hi_AQI %>%
  group_by(year) %>%
  filter(AQI == max(AQI)) %>%
  ggplot(aes(x = year,
             y = AQI,
             fill = `County Name`,
             text = `State Name`)) +
  geom_col() +
  theme(legend.position = "none") +
  labs(title = "Highest AQI Counties",
       x = "") -> highest_AQIs

ggplotly(highest_AQIs, tooltip = c("County Name", "State Name", "AQI"))
```













```{r}
states_map <- map_data("state")

pol_2000 %>%
  ggplot() +
  geom_map(map = states_map,
           aes(map_id = str_to_lower(`State Name`),
               fill = AQI)) +
  expand_limits(x = states_map$long, y = states_map$lat) +
  theme_map() +
  theme(legend.position = "right",
        plot.background = element_rect(fill = "#b6d4c8")) +
  labs(title = "20 Year Difference", fill = "CO")
```

